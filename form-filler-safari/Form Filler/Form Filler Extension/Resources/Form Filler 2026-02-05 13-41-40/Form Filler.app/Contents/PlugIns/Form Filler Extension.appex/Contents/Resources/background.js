const e=new class{constructor(){this.config={level:2,prefix:"[Form Filler]",enableInProduction:!1,enableTimestamp:!0}}shouldLog(e){return this.config.enableInProduction?e>=this.config.level:e>=3}formatMessage(e,t,...n){return[`${this.config.enableTimestamp?`[${(new Date).toISOString()}]`:""} ${this.config.prefix} ${e}:`,t,...n]}debug(e,...t){this.shouldLog(0)}info(e,...t){this.shouldLog(1)}warn(e,...t){this.shouldLog(2)}error(e,t,...n){this.shouldLog(3)&&Error}report(e,t){}group(e,t=!1){this.shouldLog(0)}groupEnd(){this.shouldLog(0)}configure(e){this.config={...this.config,...e}}};e.debug.bind(e),e.info.bind(e),e.warn.bind(e),e.error.bind(e),e.report.bind(e),e.group.bind(e),e.groupEnd.bind(e);const t="undefined"!=typeof browser?browser:chrome,n="undefined"!=typeof browser&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome");t.contextMenus.onClicked.addListener((t,n)=>{if(!n?.id)return;let r=null;"undo-fill"===t.menuItemId?r="UNDO_FILL":"clear-form"===t.menuItemId?r="CLEAR_FORM":"fill-this-field"===t.menuItemId&&(r="FILL_SINGLE_FIELD"),r&&n.id&&async function(e,t){return async function(e,t={}){const{maxRetries:n=3,delayMs:r=100,exponentialBackoff:o=!0,onRetry:i}=t;let s;for(let c=0;c<=n;c++)try{return await e()}catch(a){if(s=a instanceof Error?a:new Error(String(a)),c===n)break;i&&i(c+1,s);const e=o?r*Math.pow(2,c):r;await new Promise(t=>setTimeout(t,e))}throw s}(()=>new Promise((n,r)=>{chrome.tabs.sendMessage(e,t,e=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):n(e)})}),{maxRetries:2,delayMs:100})}(n.id,{type:r}).catch(t=>{!function(t,n,r){const o=function(e){const t=e.message.toLowerCase();return t.includes("import")||t.includes("module")?"import":t.includes("storage")||t.includes("quota")?"storage":t.includes("network")||t.includes("fetch")?"network":t.includes("element")||t.includes("dom")?"dom":t.includes("invalid")||t.includes("validation")?"validation":"unknown"}(n);e.error(`[${t}] ${n.message}`,n,{category:o,...r})}(`Context Menu: ${r}`,t,{tabId:n.id})})});const r=t.browserAction??t.action;r?.onClicked&&r.onClicked.addListener(n=>{(async()=>{if(n.id){const o={type:"FILL_FORM"};try{await t.tabs.sendMessage(n.id,o)}catch(r){const t=r instanceof Error?r:new Error(String(r));e.warn("Error sending message:",t.message)}}})()}),t.commands.onCommand.addListener((n,r)=>{(async()=>{if(!r?.id)return;let o;switch(n){case"fill_form":o={type:"FILL_FORM"};break;case"undo_fill":o={type:"UNDO_FILL"};break;case"clear_form":o={type:"CLEAR_FORM"};break;default:return}try{await t.tabs.sendMessage(r.id,o)}catch(i){const t=i instanceof Error?i:new Error(String(i));e.warn("Error sending message:",t.message)}})()}),t.runtime.onInstalled.addListener(()=>{(async()=>{new Promise(e=>{t.contextMenus.removeAll(()=>{if(n)t.contextMenus.create({id:"fill-this-field",title:"Fill This Field",contexts:["editable"]});else{const e=t.action?"action":"browser_action";t.contextMenus.create({id:"current-locale",title:"Current: Japanese (Click icon to fill form)",contexts:[e],enabled:!1}),t.contextMenus.create({id:"separator-1",type:"separator",contexts:[e]}),t.contextMenus.create({id:"undo-fill",title:"Undo Last Fill",contexts:[e]}),t.contextMenus.create({id:"clear-form",title:"Clear All Fields",contexts:[e]}),t.contextMenus.create({id:"fill-this-field",title:"Fill This Field",contexts:["editable"]})}e()})})})()});
